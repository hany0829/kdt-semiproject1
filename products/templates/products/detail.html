{% extends 'base.html' %}
{% load static %}



{% block content %}

<link rel="stylesheet" href="{% static 'css/styles.css' %}">
<link rel="stylesheet" href="{% static 'css/detail.css' %}" type="text/css">
<div class="container">
  <div class="d-flex column">
    <!-- ì œí’ˆ ì‚¬ì§„ -->
    <div class="img-area">
      <img class="detail_img" src="{{ product.image.url }}" alt="karimoku60">
    </div>
    <!-- ì œí’ˆ ì •ë³´ -->
    <div class="infoarea">
      <h2>{{ product.name }}</h2>
      <span> <img class="img_line img-margin"
          src="https://img.echosting.cafe24.com/design/skin/admin/ko_KR/ico_product_stock.gif" alt="ì¬ê³ ë³´ìœ "></span>
      <!-- í…Œì´ë¸” í˜•ì‹ (í’ˆë²ˆ, ì›ì‚°ì§€, ì œì¡°ì‚¬) -->
      <table class="table table-borderless border-one">
        <thead>
          <tr>
            <th class="tr-style " scope="col"> <span style="font-size: 15px; color: black;">í’ˆë²ˆ</span></th>
            <td>W36140GW</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th class="tr-style" scope="row"><span style="font-size: 15px; color: black;">ì›ì‚°ì§€</span></th>
            <td>JAPAN</td>
          </tr>
          <tr>
            <th class="tr-style" scope="row"><span style="font-size: 15px; color: black;">ì œì¡°ì‚¬</span></th>
            <td>Karimoku</td>
          </tr>
        </tbody>
      </table>
      <p class="gray-font">(ìµœì†Œ ì£¼ë¬¸ ìˆ˜ëŸ‰ 1ê°œ ì´ìƒ)</p>
      <div class="totoal-price">
        <strong>ì´ ìƒí’ˆê¸ˆì•¡</strong>
        (ìˆ˜ëŸ‰):
        <span class="total">
          <strong class="total-em">
            <em>780,000ì›</em>
          </strong>
          (1ê°œ)
        </span>
      </div>
      <!-- ë²„íŠ¼ (êµ¬ë§¤í•˜ê¸°,ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°) -->
      <div class="button d-flex justify-content-left">
        <button type="button" class="btn btn-dark btn-lg btn-margin"><a style="color: white;" href="#">ë°”ë¡œ
            êµ¬ë§¤í•˜ê¸°</a></button>
        <button type="button" class="btn btn-outline-secondary btn-lg"><a style="color: black;" href="#">ì¥ë°”êµ¬ë‹ˆ
            ë‹´ê¸°</a></button>
      </div>
    </div>
  </div>

  <!-- ìƒí’ˆì‚¬ìš©í›„ê¸°(ë¦¬ë·°) -->
  <div class="review-area">
    <div class="review-title">
      <h3 class="review-font">ìƒí’ˆì‚¬ìš©í›„ê¸°</h3>
      <p>ìƒí’ˆì˜ ì‚¬ìš©í›„ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”</p>
    </div>
    <div class="review-tabel">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">ë²ˆí˜¸</th>
            <th scope="col">ì œëª©</th>
            <th scope="col">ì‘ì„±ì</th>
            <th scope="col">ì‘ì„±ì¼</th>
            <th scope="col">ë³„ì </th>
            <th scope="col">ì¢‹ì•„ìš”</th>
            <!--
              ì¶”ê°€
            ì¢‹ì•„ìš”
            ì¡°íšŒìˆ˜?
            -->
            
          </tr>
        </thead>
        <tbody>
          {% for review in reviews %}
          <tr class='review'>
              <th scope="row">{{review.pk}}</th>
              <td>{{ review.title }}</td>
              <td > <a class="detail-username-link" href="{% url 'accounts:profile' review.user %} "style="color:teal; border-bottom:1px solid teal">{{ review.user }}</a></td> 
              <td>{{ review.created_at}}</td>
              <td>
                {% if review.rating == 1 %}
                  â­â˜†â˜†â˜†â˜†
                {% elif review.rating == 2 %}
                  â­â­â˜†â˜†â˜†
                {% elif review.rating == 3 %}
                  â­â­â­â˜†â˜†
                {% elif review.rating == 4 %}
                  â­â­â­â­â˜†
                {% elif review.rating == 5 %}
                  â­â­â­â­â­
                {% else %}
                  â˜†â˜†â˜†â˜†â˜†
                {% endif %}
              </td>
              <td>
                <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
                <form action="{% url 'reviews:like_review' product.pk review.pk %}" method="POST">
                  {% csrf_token %}
                  {% if request.user in review.like_users.all %}
                    <input type="submit" value="ì¢‹ì•„ìš” ì·¨ì†Œ">
                  {% else %}
                    <input type="submit" value="ì¢‹ì•„ìš”">
                  {% endif %}
                </form>
                <span class="like-count">{{ review.like_users.all.count }}</span>
                {% comment %} <form class="like-review-form" method="POST" data-url="{% url 'reviews:like_review' product.pk review.pk %}">
                  {% csrf_token %}
                  {% if request.user in review.like_users.all %}
                    <button type="submit" class="unlike-btn">ì¢‹ì•„ìš” ì·¨ì†Œ</button>
                  {% else %}
                    <button type="submit" class="like-btn">ì¢‹ì•„ìš”</button>
                  {% endif %}
                </form> {% endcomment %}
              </td> 
          </tr>
      
          <!-- ë‚´ìš© display: none-->
          <tr class='review-content' style="display: none;">
              <td colspan="6">
                <h5></h5>
                <span class="border border-primary">

                  {{ review.content }}</span>
                  <hr>
                  <!-- ëŒ“ê¸€ -->
                  {% for comment in review.comment_set.all %}
                  
                  <!-- ëŒ“ê¸€ ì‘ì„±ì -->
                  <div class="comment-user">
                    {{ comment.user.username }} 
                  </div>

                  <!-- ëŒ“ê¸€ë‚´ìš© -->
                  <div class='comment-content' style="display: none;">
                      {{ comment.content }} 
                  </div>
                  
                  {% empty %} 
                  <div class='comment-content' style="display: none;">
                      âš ï¸ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                  </div>
                  {% endfor %}
      
                  <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
                  <div class='comment-form' style="display: none;">
                      <form method="post" action="{% url 'reviews:comment_create' product_pk=product.pk review_pk=review.pk %}">
                          {% csrf_token %}
                          <div class="form-group">
                              <label for="comment_content"> <h5>ğŸ™‚ ëŒ“ê¸€ ì‘ì„±</h5></label>
                              <textarea class="form-control" id="comment_content" rows="3" name="content"></textarea>
                          </div>
                          <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ë“±ë¡</button>
                      </form>
                  </div>
              </td>
          </tr>
          {% endfor %}
      </tbody>
      </table>
      <!-- ê¸€ì“°ê¸° ë§í¬ -->
      <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-outline-secondary">
          <a  href="{% url 'reviews:create_review' product.pk %}">ë¦¬ë·° ì‘ì„±í•˜ê¸°</a>
        </button>
      </div>  
      
    </div>
  </div>
  
</div>


<!--ìë°” ìŠ¤í¬ë¦½íŠ¸-->

<script>
  // ê°ê°ì˜ review rowì™€ review-contentë¥¼ ì°¾ì•„ëƒ„
  const reviewRows = document.querySelectorAll('.review');
  const reviewContents = document.querySelectorAll('.review-content');

  // ë¯¸ë¦¬ ë¦¬ë·° ì»¨í…ì¸ ë¥¼ ê°ì¶¤
  reviewContents.forEach(content => {
    content.style.display = 'none';
  });

  // ê°ê°ì˜ review rowì— click ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€
  // ëˆ„ë¥´ë©´ ì—†ì• !
  reviewRows.forEach(row => {
    row.addEventListener('click', () => {

      // ë¦¬ë·° ë‚´ìš©
      const contentRow = row.nextElementSibling;

      // í•´ë‹¹ review-content rowë¥¼ ë³´ì—¬ì£¼ê±°ë‚˜ ê°ì¶¤
      if (contentRow.style.display === 'none') {
        contentRow.style.display = 'table-row';
      } else {
        contentRow.style.display = 'none';
      }

      // ëŒ“ê¸€í¼, ëŒ“ê¸€ ë‚´ìš©
      const commentForm = contentRow.querySelector('.comment-form');
      const commentContents = contentRow.querySelectorAll('.comment-content');

      // ëŒ“ê¸€ ì‘ì„± í¼ì„ ë³´ì—¬ì£¼ê±°ë‚˜ ê°ì¶¤
      if (commentForm.style.display === 'none') {
        commentForm.style.display = 'block';
      } else {
        commentForm.style.display = 'none';
      }

      // ê° ëŒ“ê¸€ ë‚´ìš©ì„ ë³´ì—¬ì£¼ê±°ë‚˜ ê°ì¶¤
      commentContents.forEach(commentContent => {
        if (commentContent.style.display === 'none') {
          commentContent.style.display = 'block';
        } else {
          commentContent.style.display = 'none';
        }
      });
    });
  });

  //ì¢‹ì•„ìš” ë¹„ë™ê¸°
  {% comment %} $(document).ready(function() {
    // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
    $('.like-review-form').on('submit', function(event) {
      event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ì¤‘ì§€
      const $form = $(this);
      const url = $form.data('url');
  
      $.ajax({
        url: url,
        method: 'POST',
        dataType: 'json',
        success: function(response) {
          // ì¢‹ì•„ìš” ë²„íŠ¼ ì—…ë°ì´íŠ¸
          const $likeBtn = $form.find('.like-btn');
          const $unlikeBtn = $form.find('.unlike-btn');
          const likeCount = response.like_count;
          if (response.liked) {
            $likeBtn.hide();
            $unlikeBtn.show();
          } else {
            $likeBtn.show();
            $unlikeBtn.hide();
          }
  
          // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
          $form.closest('.review-item').find('.like-count').text(likeCount);
        },
        error: function(response) {
          console.log(response);
        }
      });
    });
  }); {% endcomment %}
  {% comment %} $(document).ready(function() {
    // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
    $(document).on('submit', '.like-review-form', function(event) {
      event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ì¤‘ì§€
      const $form = $(this);
      const url = $form.data('url');
  
      $.ajax({
        url: url,
        method: 'POST',
        dataType: 'json',
        success: function(response) {
          // ì¢‹ì•„ìš” ë²„íŠ¼ ì—…ë°ì´íŠ¸
          const $likeBtn = $form.find('.like-btn');
          const $unlikeBtn = $form.find('.unlike-btn');
          const likeCount = response.like_count;
          if (response.liked) {
            $likeBtn.hide();
            $unlikeBtn.show();
          } else {
            $likeBtn.show();
            $unlikeBtn.hide();
          }
  
          // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
          $form.closest('.review-item').find('.like-count').text(likeCount);
        },
        error: function(response) {
          console.log(response);
        }
      });
    });
  }); {% endcomment %}
  
</script>







<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
  crossorigin="anonymous"></script>
{% endblock content %}



    